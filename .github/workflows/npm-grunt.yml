name: Sync Fork with Upstream

on:
  push:
    branches: ["main", "dev"]
  pull_request:
    types: [closed]
    branches: ["main", "dev"]
  workflow_dispatch:  # 수동 트리거 추가

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      # 원본 레포지토리의 내용 체크아웃
      - name: Checkout repository
        uses: actions/checkout@v3

      # GitHub 액세스를 위한 설정
      - name: Set up Git
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"

      # 포크한 레포지토리 리모트 추가
      - name: Add fork remote
        run: git remote add fork https://github.com/PSangEon/lookids-fe.git

      # 포크한 레포지토리에서 변경 사항을 푸시할 수 있도록 인증 처리 (Personal Access Token 사용)
      - name: Set up authentication
        run: |
          echo "${{ secrets.FORK_ACCESS_TOKEN }}" | git credential-store --file=.git-credentials store

      # 변경 사항을 포크한 레포지토리에 푸시
      - name: Push changes to fork
        run: |
          git push fork dev
